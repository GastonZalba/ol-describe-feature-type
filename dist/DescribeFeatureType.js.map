{"version":3,"file":"DescribeFeatureType.js","sources":["../lib/DescribeFeatureType.js"],"sourcesContent":["/**\r\n * @module ol/format/DescribeFeatureType\r\n */\r\nimport XML from 'ol/format/XML.js';\r\nimport {\r\n  makeArrayPusher,\r\n  makeObjectPropertySetter,\r\n  makeStructureNS,\r\n  pushParseAndPop,\r\n} from 'ol/xml.js';\r\nimport {\r\n  readBooleanString\r\n} from 'ol/format/xsd.js';\r\n\r\n/**\r\n * @const\r\n * @type {Array<null|string>}\r\n */\r\nconst NAMESPACE_URIS = [\r\n    null, \r\n    'http://www.opengis.net/wfs',\r\n    'http://www.opengis.net/wfs/2.0',\r\n    'http://www.opengis.net/gml',\r\n    'http://www.opengis.net/gml/3.2',\r\n    'http://www.w3.org/2001/XMLSchema'\r\n];\r\n\r\n/**\r\n * @const\r\n * @type {Object<string, Object<string, import(\"ol/xml.js\").Parser>>}\r\n */\r\n// @ts-ignore\r\nconst PARSERS = makeStructureNS(NAMESPACE_URIS, {\r\n  'complexType': makeObjectPropertySetter(readComplexType),\r\n  'import': makeObjectPropertySetter(readImport),\r\n  'element': makeObjectPropertySetter(readElement_)\r\n});\r\n\r\n/**\r\n * @classdesc\r\n * Format for reading WMS capabilities data\r\n *\r\n * @api\r\n */\r\nclass DescribeFeatureType extends XML {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  /**\r\n   * @param {Element} node Node.\r\n   * @return {Object|null} Object\r\n   */\r\n  readFromNode(node) {\r\n    const describeFeatureTypeObject = pushParseAndPop(\r\n      {\r\n        'elementFormDefault': node.getAttribute('elementFormDefault'),\r\n        'targetNamespace': node.getAttribute('targetNamespace')\r\n      },\r\n      PARSERS,\r\n      node,\r\n      [],\r\n    );\r\n    return describeFeatureTypeObject ? describeFeatureTypeObject : null;\r\n  }\r\n\r\n  /**\r\n   * Read the source document.\r\n   *\r\n   * @param {Document|Element|string} source The XML source.\r\n   * @return {Object} An object representing the source emulating a native json response.\r\n   * @api\r\n   */\r\n  readFormated(source) {\r\n    const data = this.read(source);\r\n\r\n    return {\r\n      elementFormDefault: data.elementFormDefault,\r\n      targetNamespace: data.targetNamespace,\r\n      featureTypes: data.complexType.complexContent.extension.sequence.map(e => e)\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * @const\r\n * @type {Object<string, Object<string, import(\"ol/xml.js\").Parser>>}\r\n */\r\n// @ts-ignore\r\nconst COMPLEX_TYPE_PARSERS = makeStructureNS(NAMESPACE_URIS, {\r\n  'complexContent': makeObjectPropertySetter(readComplexContent)\r\n});\r\n\r\n/**\r\n * @const\r\n * @type {Object<string, Object<string, import(\"ol/xml.js\").Parser>>}\r\n */\r\n// @ts-ignore\r\nconst COMPLEX_CONTENT_PARSERS = makeStructureNS(NAMESPACE_URIS, {\r\n  'extension': makeObjectPropertySetter(readExtension),\r\n});\r\n\r\n/**\r\n * @const\r\n * @type {Object<string, Object<string, import(\"ol/xml.js\").Parser>>}\r\n */\r\n// @ts-ignore\r\nconst EXTENSION_PARSERS = makeStructureNS(NAMESPACE_URIS, {\r\n  'sequence': makeObjectPropertySetter(readSequence)\r\n});\r\n\r\n/**\r\n * @const\r\n * @type {Object<string, Object<string, import(\"ol/xml.js\").Parser>>}\r\n */\r\n// @ts-ignore\r\nconst SEQUENCE_PARSERS = makeStructureNS(NAMESPACE_URIS, {\r\n  'element': makeArrayPusher(readElement)\r\n});\r\n\r\n/**\r\n * @param {Element} node Node.\r\n * @param {Array<*>} objectStack Object stack.\r\n * @return {Object|undefined} Capability object.\r\n */\r\nfunction readComplexType(node, objectStack) {\r\n  return pushParseAndPop({}, COMPLEX_TYPE_PARSERS, node, objectStack);\r\n}\r\n\r\n/**\r\n * @param {Element} node Node.\r\n * @param {Array<*>} objectStack Object stack.\r\n * @return {Object|undefined} Element object.\r\n */\r\nfunction readImport(node, objectStack) {\r\n  const importObject = {\r\n    'namespace': node.getAttribute('namespace'),\r\n    'schemaLocation': node.getAttribute('schemaLocation')\r\n  };\r\n  return importObject;\r\n}\r\n\r\n/**\r\n * @param {Element} node Node.\r\n * @param {Array<*>} objectStack Object stack.\r\n * @return {Object|undefined} Element object.\r\n */\r\nfunction readElement_(node, objectStack) {\r\n  const elementObject = {\r\n    'name': node.getAttribute('name'),\r\n    'substitutionGroup': node.getAttribute('substitutionGroup'),\r\n    'type': node.getAttribute('type')\r\n  };\r\n  return elementObject;\r\n}\r\n\r\n/**\r\n * @param {Element} node Node.\r\n * @param {Array<*>} objectStack Object stack.\r\n * @return {Object|undefined} Contact information object.\r\n */\r\nfunction readComplexContent(node, objectStack) {\r\n  return pushParseAndPop({}, COMPLEX_CONTENT_PARSERS, node, objectStack);\r\n}\r\n\r\n/**\r\n * @param {Element} node Node.\r\n * @param {Array<*>} objectStack Object stack.\r\n * @return {Object|undefined} Contact person object.\r\n */\r\nfunction readExtension(node, objectStack) {\r\n  return pushParseAndPop({}, EXTENSION_PARSERS, node, objectStack);\r\n}\r\n\r\n/**\r\n * @param {Element} node Node.\r\n * @param {Array<*>} objectStack Object stack.\r\n * @return {Object|undefined} Contact person object.\r\n */\r\nfunction readSequence(node, objectStack) {\r\n  return pushParseAndPop([], SEQUENCE_PARSERS, node, objectStack);\r\n}\r\n\r\n/**\r\n * @param {Element} node Node.\r\n * @param {Array<*>} objectStack Object stack.\r\n * @return {Object} Dimension object.\r\n */\r\nfunction readElement(node, objectStack) {\r\n  const elementObject = {\r\n    'name': node.getAttribute('name'),\r\n    'units': node.getAttribute('units'),\r\n    'nillable': readBooleanString(node.getAttribute('unitSymbol')),\r\n    'minOccurs': Number(node.getAttribute('minOccurs')),\r\n    'maxOccurs': Number(node.getAttribute('maxOccurs')),\r\n    'type': node.getAttribute('type'),\r\n    'localType': node.getAttribute('type').split(':')[1]\r\n  };\r\n  return elementObject;\r\n}\r\n\r\nexport default DescribeFeatureType;"],"names":["makeStructureNS","makeObjectPropertySetter","pushParseAndPop","makeArrayPusher","readBooleanString"],"mappings":"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"}