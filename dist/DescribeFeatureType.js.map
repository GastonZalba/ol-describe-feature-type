{"version":3,"file":"DescribeFeatureType.js","sources":["../lib/DescribeFeatureType.js"],"sourcesContent":["/**\r\n * @module ol/format/DescribeFeatureType\r\n */\r\nimport XML from 'ol/format/XML.js';\r\nimport {\r\n  makeArrayPusher,\r\n  makeObjectPropertyPusher,\r\n  makeObjectPropertySetter,\r\n  makeStructureNS,\r\n  pushParseAndPop,\r\n} from 'ol/xml.js';\r\nimport {readBooleanString} from 'ol/format/xsd.js';\r\n\r\n/**\r\n * @const\r\n * @type {Array<null|string>}\r\n */\r\nconst NAMESPACE_URIS = [\r\n  null,\r\n  'http://www.opengis.net/gml',\r\n  'http://www.opengis.net/gml/3.2',\r\n  'http://www.w3.org/2001/XMLSchema',\r\n];\r\n\r\n/**\r\n * @const\r\n * @type {Object<string, Object<string, import(\"ol/xml.js\").Parser>>}\r\n */\r\n// @ts-ignore\r\nconst PARSERS = makeStructureNS(NAMESPACE_URIS, {\r\n  'complexType': makeObjectPropertyPusher(readComplexType),\r\n  'import': makeObjectPropertySetter(readImport),\r\n  'element': makeObjectPropertyPusher(readElement_),\r\n});\r\n\r\n/**\r\n * @classdesc\r\n * Format for reading Describe Feature Type GML data\r\n *\r\n * @api\r\n */\r\nclass DescribeFeatureType extends XML {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  /**\r\n   * @param {Element} node Node.\r\n   * @return {Object|null} Object\r\n   */\r\n  readFromNode(node) {\r\n    const describeFeatureTypeObject = pushParseAndPop(\r\n      {\r\n        'elementFormDefault': node.getAttribute('elementFormDefault'),\r\n        'targetNamespace': node.getAttribute('targetNamespace'),\r\n        'targetPrefix': readTargetPrefix(node),\r\n      },\r\n      PARSERS,\r\n      node,\r\n      []\r\n    );\r\n    return describeFeatureTypeObject ? describeFeatureTypeObject : null;\r\n  }\r\n\r\n  /**\r\n   * Read the source document.\r\n   *\r\n   * @param {Document|Element|string} source The XML source.\r\n   * @return {Object} An object representing the source emulating a native geoserver/mapserver json response.\r\n   * @api\r\n   */\r\n  readFormated(source) {\r\n    const data = this.read(source);\r\n    return {\r\n      elementFormDefault: data.elementFormDefault,\r\n      targetNamespace: data.targetNamespace,\r\n      targetPrefix: data.targetPrefix,\r\n      featureTypes: data.complexType.map((e) => ({\r\n        typeName: e.name.replace('Type', ''),\r\n        properties: e.complexContent.extension.sequence\r\n      }))\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * @const\r\n * @type {Object<string, Object<string, import(\"ol/xml.js\").Parser>>}\r\n */\r\n// @ts-ignore\r\nconst COMPLEX_TYPE_PARSERS = makeStructureNS(NAMESPACE_URIS, {\r\n  'complexContent': makeObjectPropertySetter(readComplexContent),\r\n});\r\n\r\n/**\r\n * @const\r\n * @type {Object<string, Object<string, import(\"ol/xml.js\").Parser>>}\r\n */\r\n// @ts-ignore\r\nconst COMPLEX_CONTENT_PARSERS = makeStructureNS(NAMESPACE_URIS, {\r\n  'extension': makeObjectPropertySetter(readExtension),\r\n});\r\n\r\n/**\r\n * @const\r\n * @type {Object<string, Object<string, import(\"ol/xml.js\").Parser>>}\r\n */\r\n// @ts-ignore\r\nconst EXTENSION_PARSERS = makeStructureNS(NAMESPACE_URIS, {\r\n  'sequence': makeObjectPropertySetter(readSequence),\r\n});\r\n\r\n/**\r\n * @const\r\n * @type {Object<string, Object<string, import(\"ol/xml.js\").Parser>>}\r\n */\r\n// @ts-ignore\r\nconst SEQUENCE_PARSERS = makeStructureNS(NAMESPACE_URIS, {\r\n  'element': makeArrayPusher(readElement),\r\n});\r\n\r\n/**\r\n * @param {Element} node Node.\r\n * @param {Array<*>} objectStack Object stack.\r\n * @return {Object|undefined} Capability object.\r\n */\r\nfunction readComplexTypeContent(node, objectStack) {\r\n  return pushParseAndPop({}, COMPLEX_TYPE_PARSERS, node, objectStack);\r\n}\r\n\r\n/**\r\n * @param {Element} node Node.\r\n * @param {Array<*>} objectStack Object stack.\r\n * @return {Object|undefined} Capability object.\r\n */\r\nfunction readComplexType(node, objectStack) {\r\n  const complexType = readComplexTypeContent(node, objectStack);\r\n  if (complexType) {\r\n    complexType['name'] = node.getAttribute('name');\r\n    return complexType;\r\n  }\r\n  return undefined;\r\n}\r\n\r\n/**\r\n * @param {Element} node Node.\r\n * @param {Array<*>} objectStack Object stack.\r\n * @return {Object|undefined} Element object.\r\n */\r\nfunction readImport(node, objectStack) {\r\n  const importObject = {\r\n    'namespace': node.getAttribute('namespace'),\r\n    'schemaLocation': node.getAttribute('schemaLocation'),\r\n  };\r\n  return importObject;\r\n}\r\n\r\n/**\r\n * @param {Element} node Node.\r\n * @param {Array<*>} objectStack Object stack.\r\n * @return {Object|undefined} Element object.\r\n */\r\nfunction readElement_(node, objectStack) {\r\n  const elementObject = {\r\n    'name': node.getAttribute('name'),\r\n    'substitutionGroup': node.getAttribute('substitutionGroup'),\r\n    'type': node.getAttribute('type'),\r\n  };\r\n  return elementObject;\r\n}\r\n\r\n/**\r\n * @param {Element} node Node.\r\n * @param {Array<*>} objectStack Object stack.\r\n * @return {Object|undefined} Complex Content object.\r\n */\r\nfunction readComplexContent(node, objectStack) {\r\n  return pushParseAndPop({}, COMPLEX_CONTENT_PARSERS, node, objectStack);\r\n}\r\n\r\n/**\r\n * @param {Element} node Node.\r\n * @param {Array<*>} objectStack Object stack.\r\n * @return {Object|undefined} Extension object.\r\n */\r\nfunction readExtension(node, objectStack) {\r\n  return pushParseAndPop({}, EXTENSION_PARSERS, node, objectStack);\r\n}\r\n\r\n/**\r\n * @param {Element} node Node.\r\n * @param {Array<*>} objectStack Object stack.\r\n * @return {Array|undefined} Sequence array.\r\n */\r\nfunction readSequence(node, objectStack) {\r\n  return pushParseAndPop([], SEQUENCE_PARSERS, node, objectStack);\r\n}\r\n\r\n/**\r\n * @param {Element} node Node.\r\n * @return {string|undefined} Target Prefix.\r\n */\r\nfunction readTargetPrefix(node) {\r\n  const attributes = node.attributes;\r\n  let prefix = '';\r\n  for (let i = 0; i < attributes.length; i++) {\r\n    const attr = attributes[i].name.split(':')[1];\r\n    if (attr && !['xsd', 'xs', 'gml', 'wfs'].includes(attr)) {\r\n      prefix = attr;\r\n    }\r\n  }\r\n  return prefix;\r\n}\r\n\r\n/**\r\n * @param {Element} node Node.\r\n * @param {Array<*>} objectStack Object stack.\r\n * @return {Object} Dimension object.\r\n */\r\nfunction readElement(node, objectStack) {\r\n  const elementObject = {\r\n    'name': node.getAttribute('name'),\r\n    'maxOccurs': Number(node.getAttribute('maxOccurs')),\r\n    'minOccurs': Number(node.getAttribute('minOccurs')),\r\n    'nillable': readBooleanString(node.getAttribute('nillable')),\r\n    'type': node.getAttribute('type'),\r\n    'localType': node.getAttribute('type').split(':')[1],\r\n  };\r\n  return elementObject;\r\n}\r\n\r\nexport default DescribeFeatureType;\r\n"],"names":["makeStructureNS","makeObjectPropertyPusher","makeObjectPropertySetter","pushParseAndPop","makeArrayPusher","readBooleanString"],"mappings":"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"}